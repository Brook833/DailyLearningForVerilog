# 第六章 结构语句、系统任务、函数语句和现实系统任务

## 概述
在本章中将学习Verilog语法中两种结构语句以及如何定义和使用任务与函数，还有几个常用系统任务的用法。除了函数之外，这些语句在C语言中从来都没有定义过。特别需要注意的是，函数虽然在C语言中有过定义，但与Verilog的函数定义则完全不同。我们一定要注意这些语句所代表的物理意义，有意识地把结构语句、任务、函数与虚拟测试信号的生成或硬件电路结构联系起来。

## 6.1 结构说明语句
Verilog语言中的任何过程模块都从属于以下4种结构的说明语句:
(1) initial说明语句;
(2) always说明语句;
(3) task说明语句;
(4) function说明语句。

一个程序模块可以有多个initial和always过程块。每个initial和always说明语句在仿真的一开始同时立即开始执行。initial语句只执行一次，而always语句则是不断地重复活动着，直到仿真过程结束。但always语句后跟着的过程块是否运行，则要看它的触发条件是否满足，如满足则循行过程块一次，再次满足则再运行一次，直至仿真过程结束。

在一个模块中，使用initial和always语句的次数是不受限制的，它们都是同时开始运行的。

task和function语句可以在程序模块中的一处或多处调用。

### 6.1.1 initial语句
initial语句的格式如下:
```verilog
initial
    begin
        语句1；
        语句2；
        ...
    end
```

**注意:一个模块中可以有多个initial块，它们都是并行运行的。initial块常用于测试文件和虚拟模块的编写，用来产生仿真测试信号和设置信号记录等仿真环境。**

### 6.1.2 always语句
always语句在仿真过程中是不断活动着的。但always语句后跟着的过程块是否执行，则要看它的触发条件是否满足，如满足则运行过程块一次；如不断满足，则不断地循环执行。其声明格式如下:

`always <时序控制> <语句>`

always语句由于其不断活动的特性，只有和一定的时序控制结合在一起才有用。如果一个always语句没有时序控制，则这个always语句将会使仿真器产生死锁。

#### 1. always块的OR事件控制
有时，多个i新年好或者事件中任意一个发生的变化都能触发语句或语句块的执行。在VerIlog语言中，可以使用"或"表达式来表示这种情况。由关键词"or"连接的多个事件名或者信号名组成的列表称为敏感列表。关键词"or"被用来标识这种关系，或者使用"，"来代替。

如果输入变量很多，那么编写敏感列表会很繁琐并且容易出错。针对这种情况，Verilog提供另外两个特殊的符号`@ *`和`@(*)`，它们都表示对其后面语句块中所有输入变量的变化是敏感的。

#### 2. 电平敏感时序控制
起那面所讨论的事件控制都需要等待信号值的变化或者事件的触发，使用符号@和后面的敏感列表来表示。Verilog同时也允许使用另外一种形式表示的电平敏感时序控制。VerIlog用关键字wait来表示等待电平敏感的条件为真。

```verilog
always
    wait (count_enable) # 20 count = count + 1;
```

## 6.2 task和function说明语句
task和function说明语句分别用来定义任务和函数，利用任务和函数可以把一个很大的程序模块分解成许多较小的任务和函数便于理解和调试。输入、输出和总线信号的值可以传入、传出任务和函数。任务和函数往往还是大的程序模块中在不同地点多次用到的相同程序段。学会使用task和function语句可以简化程序的结构，是程序明白易懂，是编写较大型模块的基本功。

### 6.2.1 task和function说明语句的不同点
任务和函数有些不同，主要的不同有以下4点:
(1) 函数只能与主模块共用同一个仿真时间单位，而任务可以定义自己的仿真时间单位。
(2) 函数不能启动任务，而任务能启动其他任务和函数。
(3) 函数至少要有一个输入变量，而任务可以没有或有多个任何类型的变量。
(4) 函数返回一个值，而任务则不返回值。

函数的目的通过返回一个值来响应输入信号的值。任务却能支持多种目的，能计算多个结果值，这些结果值只能通过被调用的任务的输出或总线端口送出。Verilog HDL模块使用函数时是把它当作表达式中的操作符，这个操作的结果值就是这个函数的返回值。

### 6.2.2 task说明语句
如果传给任务的变量值和任务完成后接受结果的变量已定义，就可以用一条语句启动任务，任务完成以后控制就传回启动过程。如任务内部有定时控制，则启动的时间可以与控制返回的时间不同。任务可以启动其他的任务，其他任务又可以启动别的任务，可以启动的任务数是没有限制的。不管有多少任务启动，只有当所有的启动任务完成以后，控制才能返回。

(1) 任务的定义

```verilog
task <任务名>
    <端口及数据类型声明语句>
    <语句>
endtask
```

这些声明语句的语法与模块定义中的对应声明语句的语法是一致的。
(2) 任务的调用及变量的传递
任务的调用:

```verilog
    <任务名>(端口1, 端口2，···);
```

任务定义:
```verilog
task my_task;
    input a, b;
    inout c;
    output d, e;
    <语句>
endtask
```

任务调用:

```verilog
    my_task(v,w,x,y,z);
```

### 6.2.3 function说明语句