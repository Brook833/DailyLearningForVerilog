# 第五章 条件语句、循环语句、块语句与生成语句

## 概述
在本章中将详细的学习Verilog语法中的条件语句、循环语句、块语句和盛生成语句的写法。其中生成语句时Verilog1364-2001版标准新添加的语句。这些语句中有些与C语言很类似，所以比较容易理解。但也有些与C语言不同，如块语句、生成语句、casex和casez等。

## 5.1 条件语句(if_else语句)
Verilog HDL语言提供了3种形式的if语句。
(1)
```verilog
if (a > b)
    out1 = in1;
```
(2)
```verilog
if(a > b)
    out1 = int1;
else
    out1 = int2;
```
(3)
```verilog
if (a > b)
    out1 = int1;
else if(a < b)
    out1 = int2;
else 
    out1 = int3;
```

**注意:条件语句必须在过程块语句中使用。所谓过程块语句是指由initial和always语句引导的执行语句集合。除这两种块语句引导的begin end块中可以编写条件语句外，模块中的其他地方都不能编写。**

5点说明:
(1) 3种形式的if语句种在if后面都有表达式，一般为逻辑表达式或关系表达式。系统对表达式的值进行判断，若为0,x,z，按假处理，若为1，则为真。 
(2) 第2,3种形式的if语句，在每个else前都有一个分号；整个语句结束处有一分号。
(3) if和else中可以包含一个内嵌的操作语句，也可以有多个操作语句，此时用begin和end这两个关键词i昂几个语句包含起来成为一个复合块语句。
```verilog
if (a > b)
    begin
        out1 <= int1;
        out2 <= int2;
    end
else
    begin
        out1 <= int2;
        out2 <= int1;
    end
```
(4) 允许一定形式的表达式简写方式`if (expr)`等价于`if(expr == 1)`
(5) if语句允许嵌套

## 5.2 case语句
case语句是一种多分支选择语句，if语句只有两个分支可供选择，而实际问题中常常需要用到多分支选择，Verilog语言提供的case语句直接处理多分支选择。case语句通常用于微处理器的指令译码，一般形式如下:
(1) case(expr) <case分支项> endcase
(2) casez(expr) <case分支项> endcase
(3) casex(expr) <case分支项> endcase

case分支项的一般格式如下:
分支表达式: 语句;
默认项(default): 语句;

说明:
(1) case括弧内的表达式称为控制表达式，case分支项中的表达式称为分支表达式。控制表达式通常表示为控制信号的某些为，分支表达式则用这些控制信号的具体状态值来表示，因此分支表达式又可以称为常量表达式。
(2) 当控制表达式的值与分支表达式的值相等时，就执行分支表达式后面的语句。如果所有的分支表达式的值都没有与控制表达式的值相匹配，就执行default后面的语句。
(3) default项可有可无，一个case语句里只能有一个default项。
(4) 每一个case分项的分支表达式的值必须互不相同，否则就会出现问题。
(5) 执行完case分项后的语句，则跳出该case语句结构，终止语句的执行。
(6) 在用case语句表达式进行比较的过程中，只有当信号的对应位的值能明确进行比较时，比较才能成功。因此，要注意详细说明case分项的分支表达式的值。
(7) case语句的所有表达式值的位宽必须相等，只有这样，控制表达式和分支表达式才能进行对于位的比较。一个经常犯的错误时用'bx，'bx来替代n'bx，n'bz，这样写是不对的，因为信号x，z的默认宽度是机器的字节宽度，通常是32位。

case语句与if_else_if语句的区别主要有两点:
(1) 与case语句中的控制表达式和多分枝表达式这种比较结构相比，if_else_if结构中的条件表达式更为直观一点。
(2) 对于那些分支表达式中存在不定值x和高阻值z的位时，case语句提供了处理这种情况的手段。

## 5.5 循环语句
在Verilog HDL中存在着4种类型的循环语句，用来控制执行语句的执行次数。
(1) forever语句:连续的执行语句。
(2) repeat语句:连续执行一条语句n次。
(3) while语句:执行一条语句知道某个条件不满足。如果一开始条件即不满足(为假)，则语句一次也不能被执行。
(4) for语句，先给控制循环次数的变量赋初值，判定控制循环的表达式的值，执行语句。

### 5.5.1 forever语句
forever语句的格式如下:
`forever 语句;` 或 `forever begin 多条语句 end;`

forever循环语句常用于产生周期性的波形，用来作为仿真测试信号。它与always语句不同之处在于不能独立写在程序中，而必须写在initial块中。

### 5.5.2 repeat语句
repeat语句的格式如下:
`repeat(表达式)语句` 或 `repeat(表达式) begin 多条语句 end`

在repeat语句中，其表达式通常为常量表达式。

### 5.5.3 while语句
while语句的格式如下:
`while(表达式)语句` 或 `while(表达式) begin 多条语句 end`

### 5.5.4 for语句
for语句的一般形式为:
`for(表达式1;表达式2;表达式3) 语句`

## 5.6 顺序块和并行块
块语句的作用是将多条语句合并成一组，使它们像一条语句那样。在前面的例子中，可使用关键字begin和end将多条语句合并成一组。由于这些语句需要一条接一条的顺序执行，因此常称为顺序块。

### 5.6.1 块语句的类型
块语句包括两种类型:顺序块和并行块。

#### 1. 顺序块(也称过程块)
关键字begin-end用于将多条语句组成顺序块。

顺序块具有以下特点:
(1) 顺序块中的语句是一条接一条按顺序执行的，只有前面的语句执行完成之后才能执行后面的语句(除了带有内嵌延迟控制的非阻塞赋值语句)。
(2) 如果语句包括延迟或事件控制，那么延迟总是相对于前面那条语句执行完成的仿真事件的。

#### 2. 并行块
并行块由关键字fork-join声明。

并行块具有以下特性:
(1) 并行块内的语句并发执行
(2) 语句执行的顺序是由各自语句内延迟或事件控制决定的
(3) 语句中的延迟或事件控制是相对于块语句开始执行的时刻而言的。

并行块为我们提供了并行执行语句的机制。不过在使用并行块时需要注意，如果两条语句在同一时刻对同一个变量产生影响，那么将会引起隐含的竞争，这种情况是需要避免的。

### 5.6.2 块语句的特点

#### 1. 嵌套块
块可以嵌套使用，顺序块和并行块能够混合在一起使用。

#### 2. 命名块
块可以具有自己的名字，这称为命名块。

命名块的特点是:
(1) 命名块中可以声明局部变量
(2) 命名块是设计层次的一部分，命名块中声明的变量可以通过层次名引用进行访问；
(3) 命名块可以被禁用，例如停止其执行。

#### 3. 命名块的禁用
Verilog通过关键字disable提供了一种中止命名块执行的方法。disable可以用来从循环中退出、处理错误条件以及根据控制信号来控制某些代码是否被执行。对块语句的禁用导致紧接在块后面的那条语句被执行。类似C语言中的break。不同的是，break只能退出当前所在的循环，而disable则可以禁用设计中任意一个命名块。

## 5.7 生成块
生成语句可以动态生成Verilog代码，这一声明方便了参数化模块的生成。当对矢量中的多个位进行重复操作时，或者当进行多个模块的实例引用的重复操作时，或者在根据参数的定义来确定程序中是否应该概括某段Verilog代码的时候，使用生成语句能够大大简化程序的编写过程。

生成语句能够控制变量的声明、任务或函数的调用，还能对实例引用进行全面的控制。编写代码时必须在模块中说明生成的实例范围，关键字generate-endgenerate用来指定该范围。

生成实例可以是以下的一个或多个类型:
(1) 模块;
(2) 用户定义原语;
(3) 门级原语;
(4) 连续赋值语句;
(5) initial和always块。

生成的声明和生成的实例能够在设计中被有条件地调用(实例引用)。在设计中可以多次调用(实例引用)生成的实例和生成的变量声明。生成的实例具有唯一的标识名，因此可以用层次命名规范引用。为了支持结构化的元件与过程块语句的相互联接，Verilog语言允许在生成范围内声明下列数据类型:
(1) net(线网)、reg(寄存器);
(2) integer(整数型)、real(实型数)、time(时间型)、realtime(实数时间型);
(3) event(事件)。

生成的数据类型具有唯一的标识名，可以被层次引用。此外，究竟是使用按照次序或者参数名赋值的参数重新定义，还是使用defparam声明的参数重新定义，都可以在生成范围中定义。

**注意:生成范围中定义的defparam语句所能够重新定义的参数必须是在同一个生成范围内，或者在生成范围的层次化实例当中。**

任务和函数的声明也允许出现在生成范围之内，但是不能出现在循环生成当中。生成任务和函数同样具有唯一的标识符名称，可以被层次引用。

不允许出现在生成范围之中的模块项声明包括:
(1) 参数、局部参数；
(2) 输入、输出和输出/输出声明；
(3) 指定块。

生成模块实例的连接方法与常规模块实例相同。

在Verilog中有3种创建生成语句的方法，它们是:
(1) 循环生成；
(2) 条件生成；
(3) case生成。

### 5.7.1 循环生成语句
循环生成语句允许使用者对下面的模块或模块项进行多次实例引用:
(1) 变量声明;
(2) 模块；
(3) 用户定义原语、门级原语；
(4) 连续赋值语句；
(5) initial和always块。

### 5.7.2 条件生成语句
条件生成语句类似于if_else_if的生成构造，该结构可以在设计模块中根据经过仔细推敲并确定表达式，有条件的调用(实例引用)一下这些Verilog结构:
(1) 模块；
(2) 用户定义原语、门级原语；
(3) 连续赋值语句；
(4) initial或always块。

### 5.7.3 case生成语句
case生成语句可以在设计模块中，根据仔细推敲确定多选一case构造，有条件地调用(实例引用)下面这些Verilog结构:
(1) 模块；
(2) 用户定义原语、门级原语；
(3) 连续赋值语句；
(4) initial或always块。
